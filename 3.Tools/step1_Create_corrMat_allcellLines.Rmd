---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
knitr::knit('/Users/sinhas8/Project_TrueTarget/Tools_github/3.Tools/Step0_Write_Functions.Rmd')
knitr::knit('/Users/sinhas8/Project_TrueTarget/Tools_github/3.Tools/Step0B_Data_and_Libraries.Rmd')
```
<!-- Features of avana and drug screen -->
```{r}
# onTarget$avana_22Q2 <- t(onTarget$avana_22Q2)
common_cellLines=intersect(colnames(onTarget$avana_22Q2),
                           colnames(onTarget$secondary_prism))
all_genenames=rownames(onTarget$avana_22Q2)
all_drugNames=rownames(onTarget$secondary_prism)
drugSubset_map2_annotation <- match(rownames(onTarget$secondary_prism),
        onTarget$drugCategory$broad_id_trimmed)
all_drugNames_common=onTarget$drugCategory$name[drugSubset_map2_annotation]
all_drugTargets=onTarget$drugCategory$target[drugSubset_map2_annotation]
all_drugMOA=onTarget$drugCategory$moa[drugSubset_map2_annotation]
```
<!-- Run correlation btw all crispr vs all drugs -->
```{r}
# tic()
# drugVScrispr_corr_features_list=mclapply(all_drugNames, function(x) correlation_bet_crispr_drug(x), mc.cores = detectCores())
# names(drugVScrispr_corr_features_list)=all_drugNames
# toc()
# saveRDS(drugVScrispr_corr_features_list,
#         '/Users/sinhas8/Project_TrueTarget/Data/drugVScrispr_corr_features_list.RDS')
```
<!-- Get only the correlation strength matrix-->
```{r}
drugVScrispr_corr_features_list=readRDS('/Users/sinhas8/Project_TrueTarget/Data/drugVScrispr_corr_features_list.RDS')
drugVScrispr_corr_Strength=sapply(drugVScrispr_corr_features_list, function(x) x[,2])
```
<!-- Identify the known target Correlation -->
```{r}
# all_drugTargets_seperated=sapply(as.character(all_drugTargets),
#                                  function(x) strsplit(x, ', '))
# all_drugTargets_correlation=sapply(1:length(all_drugTargets_seperated),
#       function(x) {
#         ret_cor=drugVScrispr_corr_Strength[
#           match(all_drugTargets_seperated[[x]],
#                 rownames(drugVScrispr_corr_Strength)), x]
#         names(ret_cor)=err_handle(all_drugTargets_seperated[[x]])
#         ret_cor
#         } )
# all_drugTargets_correlation['dabrafenib']
# names(all_drugTargets_correlation) <- as.character(all_drugNames_common)
# all_drugTargets_MAXcorrelation=sapply(all_drugTargets_correlation, function(x) max(x, na.rm=T))
# all_drugTargets_MAXcorrGene=sapply(all_drugTargets_correlation,
#                                       function(x) names(which.max(x)))
# all_drugTargets_MAXcorrGene[sapply(all_drugTargets_MAXcorrGene, length)==0]=NA
# KnownTarget_predictions=data.frame(
#   drugName=names(all_drugTargets_MAXcorrelation),
#   MaxTargetName=unlist(all_drugTargets_MAXcorrGene),
#   Maxcorr=all_drugTargets_MAXcorrelation)
# KnownTarget_predictions=KnownTarget_predictions[order(KnownTarget_predictions$Maxcorr, decreasing = T),]
```

```{r}
dim(onTarget$drugCategory)
category_inhibitor=c('inhibitor', 'antagonist', 'blocker')
category_activator=c('agonist', 'activator', 'stimulant')
category_inhibitor_drugs_ID=sapply(category_inhibitor, function(x) grep(x, onTarget$drugCategory$moa))
category_activator_drugs_ID=sapply(category_activator, function(x) grep(x, onTarget$drugCategory$moa))
category_inhibitor_drugs_ID=unique(unlist(category_inhibitor_drugs_ID))
category_activator_drugs_ID=unique(unlist(category_activator_drugs_ID))
onTarget$drugCategory$is.inhibitor=F
onTarget$drugCategory$is.inhibitor[category_inhibitor_drugs_ID]=T
onTarget$drugCategory$is.activator=F
onTarget$drugCategory$is.activator[category_activator_drugs_ID]=T
```


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

