---
title: "TGO2- glioblastoma celline"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 
<!-- Extract TG02 response -->
```{r}
```
<!-- Compute correlation -->
```{r}
matched_cellLines=intersect(colnames(onTarget$avana), names(tg02_crispr))
correlation_withTG02=apply(onTarget$avana[,matched_cellLines], 1, function(x)
  unlist(cor.test_trimmed_v0(x, tg02_crispr[matched_cellLines]))
  )
```
<!-- Compute correlation -->
```{r}
correlation_withTG02=as.data.frame(t(correlation_withTG02))
correlation_withTG02=correlation_withTG02[order(correlation_withTG02$estimate.cor, decreasing = T),]
correlation_withTG02$geneRank=1:nrow(correlation_withTG02)
```
<!-- Repeat correlation in a given cancer type -->
```{r}
compute_cor_for_a_drug<- function(infunc_drugName='TG-02',
                                  COI=matched_cellLines){
  # KO data
  tg02_id=grep(infunc_drugName,onTarget$drugsCommonName)
  broad_id_tg02=onTarget$drugCategory$broad_id_trimmed[
    grep('TG-02',onTarget$drugCategory$name)]
  tg02_crispr=onTarget$secondary_prism[broad_id_tg02,]
  # COI stands for Cell lines of Interest
  # Cmpute correlation
  COI_matched=intersect(COI, matched_cellLines)
  correlation_mat=apply(onTarget$avana[,COI_matched], 1, function(x)
    unlist(cor.test_trimmed_v0(x, tg02_crispr[COI_matched]))
  )
  correlation_mat=as.data.frame(t(correlation_mat))
  correlation_mat=correlation_mat[
    order(correlation_mat$estimate.cor, decreasing = T),]
  correlation_mat$geneRank=1:nrow(correlation_mat)
  correlation_mat
}
```
<!-- GBM cell lines -->
<!-- We do not have enough GBM celllines -->
```{r}
gbm_cellLines=onTarget$annotation$depMapID[which(onTarget$annotation$tcga_code=='GBM')]
correlation_withTG02_gbm=compute_cor_for_a_drug(infunc_drugName='TG-02',COI=gbm_cellLines)
correlation_withTG02_gbm[grep('CDK9',rownames(correlation_withTG02_gbm)),]
correlation_withTG02_gbm[grep('LTA',rownames(correlation_withTG02_gbm)),]
```

<!-- IDH mutant cell lines -->

```{r}
idh_id=which(rownames(onTarget$mutations_matrix)=='IDH1' | 
               rownames(onTarget$mutations_matrix)=='IDH2')
idh_mutation_status=apply(onTarget$mutations_matrix[idh_id,], 2, max)
IDHMutant_cellLines=which(as.logical(idh_mutation_status))
IDHMutant_cellLines=names(idh_mutation_status)[IDHMutant_cellLines]
correlation_withTG02_idh=compute_cor_for_a_drug(infunc_drugName='TG-02',
                                                COI=IDHMutant_cellLines)
correlation_withTG02_idh[grep('CDK9',rownames(correlation_withTG02_idh)),]
correlation_withTG02_idh[grep('LTA',rownames(correlation_withTG02_idh)),]
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

